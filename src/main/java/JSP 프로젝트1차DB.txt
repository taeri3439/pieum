-- 테이블삭제
--DROP TABLE TAG;
--DROP TABLE TIMECAPSULE;
--DROP TABLE TTC_MAPPING;
--DROP TABLE GROUPS;
--DROP TABLE MEMBER;
--DROP TABLE NOTICE;
--DROP TABLE COMMENTS;
--DROP TABLE FILES;
--DROP TABLE LIKES;
--DROP TABLE UG_MAPPING;

-- 제약조건 삭제
-- PK
--ALTER TABLE TTC_MAPPING DROP CONSTRAINT PK_TTC_MAPPING;
--ALTER TABLE UG_MAPPING DROP CONSTRAINT PK_UG_MAPPING;
-- FK
--ALTER TABLE TTC_MAPPING DROP CONSTRAINT FK_TAG_TO_TTC_MAPPING;
--ALTER TABLE TTC_MAPPING DROP CONSTRAINT FK_TIMECAPSULE_TO_TTC_MAPPING;
--ALTER TABLE UG_MAPPING DROP CONSTRAINT FK_USER_TO_UG_MAPPING;
--ALTER TABLE UG_MAPPING DROP CONSTRAINT FK_GROUP_TO_UG_MAPPING;


--CREATE TABLE temp_TAG AS
--SELECT * FROM TAG
--ORDER BY TNO ASC;
--DROP TABLE TAG;
--ALTER TABLE temp_TAG RENAME TO TAG;

-- 시퀀스 삭제
--DROP SEQUENCE TC_SEQ;
--CREATE SEQUENCE ADMIN_SEQ
--CREATE SEQUENCE USER_SEQ
----------------------------------------------------------
-- 테이블 정의
CREATE TABLE TAG (
	TNO	VARCHAR(20) PRIMARY KEY,-- 태그번호
    TNAME	VARCHAR(20) NOT NULL -- 태그명
);


CREATE TABLE TIMECAPSULE (
	TCNO	VARCHAR2(20) PRIMARY KEY, -- 타입캡슐 아이디
	TCREGDATE	TIMESTAMP	DEFAULT SYSDATE, -- 작성날짜
	OPENDATE	TIMESTAMP	NOT NULL, -- 컨텐츠 공개날짜
	TCTITLE	VARCHAR2(200)	NOT NULL, -- 제목
	TCCONTENT	VARCHAR2(2000)	NOT NULL, -- 내용
	PRIVATES	CHAR(1) DEFAULT 'N', -- 공개여부
	VIEWCT	NUMBER DEFAULT 0, -- 조회수
	GNO	VARCHAR2(20)	NOT NULL, -- 그룹아이디
	MNO	VARCHAR2(20)	NOT NULL -- 사용자아아디
);


CREATE TABLE GROUPS (
	GNO	VARCHAR2(20) PRIMARY KEY, -- 그룹번호
	GNAME	VARCHAR2(20)	NOT NULL, -- 그룹명
	GMEMBERCT	NUMBER	DEFAULT 1, -- 최대 그룹인원수설정
	GREGDATE	TIMESTAMP	DEFAULT SYSDATE, -- 그룹 창설일자
	MNO	VARCHAR2(20)	NOT NULL -- 그룹장 유저번호
);


CREATE TABLE TTC_MAPPING (
	TNO	VARCHAR(20)	NOT NULL, -- 태그번호(FK)(SUPER KEY)
	TCNO	VARCHAR(20)	NOT NULL -- 타임캡슐번호(FK) (SUPER KEY)
);


CREATE TABLE MEMBER (
	MNO	VARCHAR2(20)	PRIMARY KEY, -- 유저번호(관리자:M , 일반유저:U ) 예시:M000001
	MID	VARCHAR2(20)	NOT NULL, -- 유저아이디
	MPW	VARCHAR2(20)	NOT NULL,-- 비밀번호
	MNAME	VARCHAR2(20)	NOT NULL, -- 유저명
	GENDER	VARCHAR2(20)	NOT NULL, -- 성별
	BIRTH	VARCHAR2(20)	NOT NULL, -- 생년월일
	PHONE	VARCHAR2(20)	NOT NULL, -- 전화번호
    EMAIL   VARCHAR2(30)    NOT NULL, -- 이메일
	AGREE1	CHAR(1)	DEFAULT 'N', -- 동의사항1
	AGREE2	CHAR(1) DEFAULT 'N', -- 동의사항2
	AGREE3	CHAR(1)	DEFAULT 'N' -- 동의사항3
);

select * from member;
CREATE TABLE NOTICE (
	NNO	VARCHAR2(20)	PRIMARY KEY, -- 문의,공지 사항 컨텐츠 번호
	MNO	VARCHAR2(20)	NOT NULL, -- 작성자번호(FK)
	NTITLE	VARCHAR2(500)	NOT NULL, -- 제목
	NCONTENT	VARCHAR2(1500)	NOT NULL, -- 내용
    NTYPE       VARCHAR2(10)     NOT NULL, -- 공지/문의 분류 변수
	NREGDATE	TIMESTAMP	DEFAULT SYSDATE, -- 작성일자
	ACONTENT	VARCHAR2(500) -- 답변내용(답변 안헀으면 NULL)
);


CREATE TABLE COMMENTS (
	CNO	VARCHAR2(20)	PRIMARY KEY, -- 댓글번호
	CCONTENT	VARCHAR2(500)	NOT NULL, -- 댓글내용
	CREGDATE	TIMESTAMP	DEFAULT SYSDATE, -- 댓글작성일자
	TCNO	VARCHAR2(20)	NOT NULL, -- 타임캡슐번호
	MNO	VARCHAR2(20) -- 비회원도 작성할 수 있기에 NOT NULL설정 안함
);


CREATE TABLE UG_MAPPING (
	MNO	VARCHAR(20)	NOT NULL,--유저번호(FK)(SUPER KEY)
	GNO	VARCHAR(20)	NOT NULL,-- 그룹번호(FK) (SUPER KEY)
	GACCEPT	CHAR(1)	DEFAULT 'N', -- 그룹초대 수락여부
	GOUT	CHAR(1)	 -- 그룹탈퇴여부 ( 그룹 초대 후 N으로 변경, 그전에는 NULL)
);

CREATE TABLE FILES (
	FNO     VARCHAR2(20) PRIMARY KEY, -- 파일번호
    FILENAME VARCHAR2(100)	NOT NULL, -- 파일명
    FILEDATA BLOB   NOT NULL,          -- (실제 파일 저장)
	TCNO	VARCHAR2(20)	NOT NULL -- 타입캡슐번호
);

select * from files;
select * from timecapsule;
select * from tag;


CREATE TABLE LIKES (
	LNO	VARCHAR2(20)	PRIMARY KEY, -- 번호
	MNO	VARCHAR2(20)	NOT NULL, -- 사용자번호
	CNO	VARCHAR2(20)	NOT NULL -- 댓글번호
);
-----------------------------------------------
--시퀀스 생성

-- 타입캘슐 시퀀스 생성
CREATE SEQUENCE TC_SEQ 
    START WITH 1 INCREMENT BY 1 
    MAXVALUE 10000 MINVALUE 1 
    NOCYCLE NOCACHE;

CREATE SEQUENCE NOTICE_SEQ 
    START WITH 1 INCREMENT BY 1 
    MAXVALUE 100000 MINVALUE 1 
    NOCYCLE NOCACHE;
    
-- 멤버 시퀀스 생성(관리자)
CREATE SEQUENCE ADMIN_SEQ 
    START WITH 1 INCREMENT BY 1 
    MAXVALUE 100000 MINVALUE 1 
    NOCYCLE NOCACHE;
    
-- 멤버 시퀀스 생성(유저)
CREATE SEQUENCE USER_SEQ 
    START WITH 1 INCREMENT BY 1 
    MAXVALUE 100000 MINVALUE 1 
    NOCYCLE NOCACHE;

-- 파일번호 시퀀스
CREATE SEQUENCE FILE_SEQ 
    START WITH 1 INCREMENT BY 1 
    MAXVALUE 10000 MINVALUE 1 
    NOCYCLE NOCACHE;

-- 태그번호 시퀀스
CREATE SEQUENCE TAG_SEQ 
    START WITH 1 INCREMENT BY 1 
    MAXVALUE 10000 MINVALUE 1 
    NOCYCLE NOCACHE;
-------------------------------------------------------

-- 제약조건
-- 슈퍼키
ALTER TABLE TTC_MAPPING ADD CONSTRAINT PK_TTC_MAPPING PRIMARY KEY (
	TNO,TCNO
);

ALTER TABLE UG_MAPPING ADD CONSTRAINT PK_UG_MAPPING PRIMARY KEY (
	MNO,GNO
);
-- 외래키
ALTER TABLE TTC_MAPPING ADD CONSTRAINT FK_TAG_TO_TTC_MAPPING FOREIGN KEY (TNO)REFERENCES TAG (TNO); -- 태그 ~ 맵핑테이블 ~ 타입 캡슐
ALTER TABLE TTC_MAPPING ADD CONSTRAINT FK_TIMECAPSULE_TO_TTC_MAPPING FOREIGN KEY (TCNO) REFERENCES TIMECAPSULE(TCNO); -- 타임캡슐 ~ 맵핑테이블 ~ 태그
ALTER TABLE UG_MAPPING ADD CONSTRAINT FK_USER_TO_UG_MAPPING FOREIGN KEY (MNO)REFERENCES MEMBER (MNO); -- 유저테이블 ~ 맵핑 ~ 그룹
ALTER TABLE UG_MAPPING ADD CONSTRAINT FK_GROUP_TO_UG_MAPPING FOREIGN KEY (GNO)REFERENCES GROUPS (GNO); -- 그룹 ~ 맵핑 ~ 유저테이블


--ALTER TABLE NOTICE ADD NTYPE VARCHAR(20) NOT NULL;
--ALTER TABLE FILES ADD FILEDATA BLOB NOT NULL;
--ALTER TABLE FILES DROP COLUMN FILENAME;
--ALTER TABLE FILES ADD FILENAME VARCHAR2(100) NOT NULL;

select * from tag;
--INSERT INTO TAG VALUES(TAG_SEQ.NEXTVAL,'감성적인');
--INSERT INTO TAG VALUES(TAG_SEQ.NEXTVAL,'슬픔');
--INSERT INTO TAG VALUES(TAG_SEQ.NEXTVAL,'기쁨');
--INSERT INTO TAG VALUES(TAG_SEQ.NEXTVAL,'감동');
--INSERT INTO TAG VALUES(TAG_SEQ.NEXTVAL,'화남');
--INSERT INTO TAG VALUES(TAG_SEQ.NEXTVAL,'맑음');
--INSERT INTO TAG VALUES(TAG_SEQ.NEXTVAL,'흐림');
--INSERT INTO TAG VALUES(TAG_SEQ.NEXTVAL,'비');
--INSERT INTO TAG VALUES(TAG_SEQ.NEXTVAL,'눈');
--INSERT INTO TAG VALUES(TAG_SEQ.NEXTVAL,'천둥');
--INSERT INTO TAG VALUES(TAG_SEQ.NEXTVAL,'쇼핑');
--INSERT INTO TAG VALUES(TAG_SEQ.NEXTVAL,'운동');
--INSERT INTO TAG VALUES(TAG_SEQ.NEXTVAL,'공부');
--INSERT INTO TAG VALUES(TAG_SEQ.NEXTVAL,'여행');
--INSERT INTO TAG VALUES(TAG_SEQ.NEXTVAL,'휴식');
--COMMIT;
